### [[快速獲取特定用戶的歷史推文]] 需求規範摘要

這份筆記是一份詳細的系統需求規範文檔，旨在定義一個工具的功能：不僅能快速獲取特定Twitter/X用戶的歷史推文，還能將查詢結果**持久化存儲到主流數據庫**中，以便後續分析和複用。

#### 核心功能模塊與要求

| 功能模塊 | 核心要求 |
| :--- | :--- |
| **1. 輸入與觸發** | • 接收用戶標識（如 `@username`）、關鍵詞、日期範圍等作為查詢條件。<br>• 所有查詢操作本身需記錄到數據庫的 `query_log` 表中，以便審計和追溯。 |
| **2. 數據獲取** | • 通過 Twitter/X API v2 獲取公開推文。<br>• 需考慮 API 的請求頻率限制，並通過緩存（如 Redis）提高效率，避免重複請求。 |
| **3. 數據持久化** | • **數據庫選型**：優先使用 **PostgreSQL**，備選 MySQL。<br>• **推文數據**：將獲取的推文列表批量寫入 `tweets` 表。若推文已存在（ID重複），則更新轉發數、點贊數等信息（`ON CONFLICT` 邏輯），避免數據冗餘。<br>• **查詢日誌**：將每次查詢的元數據（輸入參數、時間、狀態）寫入 `query_log` 表。<br>• **數據一致性**：數據庫的寫入操作需**事務化**，確保 `tweets` 表和 `query_log` 表的數據同步成功或失敗。 |
| **4. 輸出與查詢** | • **即時返回**：完成 API 請求和數據庫寫入後，向用戶返回推文列表（JSON格式）和一個唯一的 `query_id`。<br>• **歷史查詢**：提供專門的 API 端點（如 `/tweets/stored`），允許用戶使用 `query_id` 或用戶名直接從數據庫中快速查詢已存儲的歷史推文。 |

#### 核心數據庫表結構

*   **推文表 (`tweets`)**:
    *   `tweet_id`: 推文的唯一ID（主鍵）。
    *   `username`: 推文作者。
    *   `text`: 推文內容。
    *   `created_at`: 發布時間。
    *   `retweet_count`, `like_count`: 轉發與點贊數。
    *   `query_id`: 關聯到本次查詢的ID（外鍵）。

*   **查詢日誌表 (`query_log`)**:
    *   `query_id`: 該次查詢的唯一ID（主鍵）。
    *   `user_identifier`: 查詢的目標用戶。
    *   `keywords`, `date_range_start`, `date_range_end`: 查詢時使用的過濾條件。
    *   `query_time`: 查詢發生的時間。
    *   `status`: 查詢結果狀態（成功/失敗）。