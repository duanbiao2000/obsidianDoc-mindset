

### 重要目标/问题

*   **产品愿景：**
    *   构建一个轻量、易用、高性能的嵌入式或独立关系型数据库。
    *   专注于核心数据存储与查询功能。
    *   为开发者提供一个简单、可靠、低开销的数据管理解决方案。
    *   特别适用于小型应用、原型开发和教育场景。
*   **核心价值主张：** 简单、可靠、高性能（针对小规模数据）、低开销。
*   **用户痛点：**
    *   现有企业级数据库过于庞大、复杂，学习曲线陡峭，资源消耗高。
    *   轻量级数据库功能有限或缺乏某些关系型特性。
    *   需要一个开箱即用、无需复杂部署和维护的数据库。
    *   希望数据库核心功能稳定可靠，数据不易丢失或损坏。
*   **项目阶段目标：**
    *   **架构设计：** 明确数据库的高层结构和核心组件，为后续开发奠定基础。
    *   **技术栈选型：** 为每个架构组件选择具体的 Go 语言库、工具和实现方法。
    *   **WBS 设定：** 将项目分解为可管理、可估算、可分配的任务。

### 背景知识

*   **核心数据库理论知识：**
    *   **关系模型：** 理解表、行、列、域等概念，作为数据库设计的基石。
    *   **SQL 语言：** 熟悉 DDL (`CREATE TABLE`, `ALTER TABLE`, `DROP TABLE`) 和 DML (`INSERT`, `SELECT`, `UPDATE`, `DELETE`) 的语法和语义。
    *   **数据完整性与约束：** 理解主键、外键、非空、唯一、检查等约束，确保数据质量。
    *   **事务与 ACID 特性：** 掌握原子性 (Atomicity)、一致性 (Consistency)、隔离性 (Isolation)、持久性 (Durability) 的概念及其重要性。
    *   **并发控制：** 了解脏读、不可重复读、幻读等问题，以及锁机制、MVCC、隔离级别（如读已提交）等解决方案。
    *   **索引：** 理解 B-树和 B+树的原理和应用，以优化查询性能。
    *   **存储引擎基础：** 了解数据页管理、行存储格式、文件组织方式，以优化读写性能。
    *   **查询处理与优化：** 了解词法分析、语法分析、抽象语法树 (AST)、查询计划等概念。
*   **行业规范与最佳实践：**
    *   **SQL 标准兼容性：** 了解 SQL-92 或更高版本核心子集。
    *   **API 设计原则：** 参考 Go 语言 `database/sql` 包及其他主流客户端 API。
    *   **测试策略：** 熟悉单元测试、集成测试、性能测试、压力测试、模糊测试。
    *   **文档规范：** 清晰、简洁、准确的内部设计文档、API 文档、用户指南。
    *   **Go 语言最佳实践：** 错误处理、并发模式、内存管理、代码风格。
    *   **版本控制与协作：** Git 工作流、Issue Tracking。

### 核心概念

*   **极简DB (MinimalistDB)：** 本项目的数据库产品名称。
*   **优化幅度：** 衡量优化动作对笔记质量的提升程度。
*   **路径权重：** 衡量优化动作在笔记使用全流程中的关键程度。
*   **优化的价值：** 优化幅度与路径权重的乘积，用于量化优先级。
*   **数据库核心组件：**
    *   **SQL 解析器 (SQL Parser/Lexer)：** 将 SQL 字符串转换为抽象语法树 (AST)。
    *   **查询规划器 (Query Planner)：** 对 AST 进行初步优化，生成执行计划。
    *   **执行引擎 (Execution Engine)：** 遍历执行计划，调用存储引擎执行操作。
    *   **存储引擎 (Storage Engine)：** 负责数据持久化、索引管理、页管理。
    *   **事务管理器 (Transaction Manager)：** 确保 ACID 特性，处理并发控制和崩溃恢复。
    *   **API 层 (API Layer)：** 对外提供编程语言接口。

### 关键细节


*   **V1.0 排除范围：** 分布式事务、分片、主从复制、存储过程、触发器、视图（复杂）、用户自定义函数、高级查询优化器、全文搜索、地理空间/JSON/XML数据类型、复杂权限管理、高并发企业级工作负载。
*   **核心功能设计细节：**
    *   **SQL 引擎：** SQL 解析器（生成 AST）、查询规划器（极简优化）、执行引擎。
    *   **存储引擎：** 基于文件系统持久化（数据文件、索引文件、日志文件），行式存储，B+树索引，数据页管理。
    *   **事务管理：** 并发控制（嵌入式模式：读写锁/单写多读；独立服务器模式：简化行锁/MVCC），基于日志文件实现崩溃恢复。
    *   **API 设计：** 示例 Go 语言原生 API (`MinimalistDB` 类，`connect`, `close`, `execute`, `fetchone`, `fetchall`, `commit`, `rollback` 等方法)。
*   **技术选型（初步考虑）：**
    *   **开发语言：** Rust/C++ (性能高)，Go (并发模型优秀，部署简单)，Python (快速原型)。
    *   **文件格式：** 自定义二进制文件格式或参考 SQLite。
    *   **SQL 解析：** 手写 Lexer/Parser 或使用现有 Go 库（如 `vitess/go/vt/sqlparser`）。
    *   **数据结构与存储：** 自行实现或寻找 Go 语言 B+树库，利用 Go `os` 包进行文件 I/O，考虑 `mmap`。
    *   **并发与事务：** Go `sync` 包 (Mutex, RWMutex) 实现读写锁，初期实现“读已提交”隔离级别，日志用于 WAL。
    *   **网络通信：** Go `net` 包构建 TCP 服务器，初期自定义简单二进制协议。
    *   **测试与工具：** Go `testing` 包（单元测试、Benchmark），Go `log` 包或结构化日志库。
*   **WBS 阶段划分：**
    *   **Phase 0: 基础与环境搭建：** 项目初始化、核心数据结构（Page、B+Tree、序列化）、文件持久化基础（WAL）。
    *   **Phase 1: 核心 SQL 引擎 (DDL & Basic DML)：** SQL 解析器（Lexer、Parser、AST）、Schema 管理（表元数据、`CREATE/DROP TABLE`）、基本数据操作（行存储、`INSERT`、`SELECT *`）。
    *   **Phase 2: 查询与过滤：** 条件查询 (`WHERE`、表达式求值)、排序与限制 (`ORDER BY`、`LIMIT`)、索引管理（主键自动索引、`CREATE/DROP INDEX`、索引查找优化）。
    *   **Phase 3: 事务与高级 DML：** 事务管理 (`BEGIN/COMMIT/ROLLBACK`、并发控制、崩溃恢复)、数据修改 (`UPDATE`、`DELETE`)、聚合与连接（聚合函数、`GROUP BY`、`INNER/LEFT JOIN`）。
    *   **Phase 4: API 与集成：** Go 原生 API 设计与实现、独立服务器模式（TCP 服务器、网络协议、认证）、客户端库（可选）。
    *   **Phase 5: 测试与文档：** 全面测试（单元、集成、性能、压力）、文档编写（开发者指南、架构文档、部署指南）。
